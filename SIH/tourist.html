<!DOCTYPE html>
<html>
    <head>
        <title>Tourist Management - Tourism Authority of India</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    </head>
    <style>
    body {
        background-color: white;
    }

    :root {
        --sidebar-width: 250px;
        --primary-dark: #1e293b;
        --secondary-dark: #334155;
        --text-light: #f8fafc;
        --accent-blue: #3b82f6;
        --danger-red: #ef4444;
        --warning-yellow: #f59e0b;
        --success-green: #10b981;
    }

    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--sidebar-width);
        background: linear-gradient(180deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
        color: var(--text-light);
        z-index: 1000;
        transition: transform 0.3s ease;
    }

    .sidebar-header {
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h4 {
        margin: 0;
        font-weight: 300;
        color: var(--accent-blue);
    }

    .sidebar-nav {
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .sidebar-nav li {
        margin: 5px 0;
    }

    .sidebar-nav a {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        color: var(--text-light);
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .sidebar-nav a:hover,
    .sidebar-nav a.active {
        background-color: rgba(59, 130, 246, 0.2);
        color: var(--accent-blue);
        border-right: 3px solid var(--accent-blue);
    }

    .sidebar-nav i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
    }

    .main-content {
        margin-left: var(--sidebar-width);
        padding: 20px;
        min-height: 100vh;
        background-color: #f1f5f9;
    }

    /* Tourist Management System Styles */
    .tourists-header {
        background: white;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }

    .tourists-title {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
    }

    .tourists-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, var(--accent-blue), #1e40af);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    .tourists-title h1 {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-dark);
        margin: 0;
    }

    .tourists-subtitle {
        color: #64748b;
        font-size: 16px;
        margin: 0;
    }

    /* Search and Filters */
    .tourists-controls {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }

    .search-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        margin-bottom: 16px;
    }

    .search-input {
        flex: 1;
        min-width: 300px;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .filter-label {
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-select {
        padding: 8px 12px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        font-size: 14px;
        min-width: 140px;
        transition: border-color 0.3s ease;
    }

    .filter-select:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .view-toggle {
        display: flex;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        overflow: hidden;
    }

    .view-btn {
        padding: 8px 16px;
        background: white;
        border: none;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .view-btn.active {
        background: var(--accent-blue);
        color: white;
    }

    /* Tourist Layout */
    .tourists-layout {
        display: grid;
        grid-template-columns: 1fr 450px;
        gap: 20px;
        height: calc(100vh - 250px);
    }

    .tourists-layout.list-view {
        grid-template-columns: 1fr;
    }

    /* Tourist Directory Table */
    .tourists-directory {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
    }

    .tourists-table-header {
        background: #f8fafc;
        padding: 16px;
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        color: var(--primary-dark);
        display: grid;
        grid-template-columns: 140px 200px 120px 140px 160px 100px 180px 80px;
        gap: 12px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .tourists-table-body {
        flex: 1;
        overflow-y: auto;
    }

    .tourist-row {
        padding: 16px;
        border-bottom: 1px solid #f1f5f9;
        display: grid;
        grid-template-columns: 140px 200px 120px 140px 160px 100px 180px 80px;
        gap: 12px;
        align-items: center;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .tourist-row:hover {
        background: #f8fafc;
    }

    .tourist-row.selected {
        background: rgba(59, 130, 246, 0.05);
        border-left: 4px solid var(--accent-blue);
    }

    /* Status Indicators */
    .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        font-weight: 600;
    }

    .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .status-safe .status-dot {
        background: var(--success-green);
    }

    .status-monitoring .status-dot {
        background: var(--warning-yellow);
    }

    .status-alerted .status-dot {
        background: var(--danger-red);
    }

    .status-inactive .status-dot {
        background: #64748b;
    }

    /* Tourist Profile Panel */
    .tourist-profile-panel {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
    }

    .profile-header {
        background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
        color: white;
        padding: 24px;
        text-align: center;
        position: relative;
    }

    .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        margin: 0 auto 16px;
        border: 3px solid rgba(255, 255, 255, 0.3);
    }

    .profile-name {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .profile-id {
        font-size: 14px;
        opacity: 0.8;
    }

    .profile-content {
        flex: 1;
        overflow-y: auto;
    }

    .profile-section {
        padding: 20px;
        border-bottom: 1px solid #f1f5f9;
    }

    .profile-section:last-child {
        border-bottom: none;
    }

    .section-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 16px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .profile-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 14px;
    }

    .profile-label {
        color: #64748b;
        font-weight: 500;
    }

    .profile-value {
        color: var(--primary-dark);
        font-weight: 600;
        text-align: right;
    }

    .masked-value {
        font-family: monospace;
        background: #f8fafc;
        padding: 2px 6px;
        border-radius: 4px;
        border: 1px solid #e2e8f0;
    }

    /* Digital ID Section */
    .digital-id-card {
        background: linear-gradient(135deg, var(--accent-blue), #1e40af);
        color: white;
        padding: 16px;
        border-radius: 8px;
        text-align: center;
        margin: 12px 0;
    }

    .qr-code {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 8px;
        margin: 0 auto 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-dark);
        font-size: 24px;
    }

    .validity-status {
        font-size: 12px;
        margin-top: 8px;
        opacity: 0.9;
    }

    /* Safety History */
    .history-timeline {
        position: relative;
        padding-left: 20px;
    }

    .history-item {
        position: relative;
        padding: 12px 0;
        border-left: 2px solid #e2e8f0;
        padding-left: 20px;
        margin-left: 10px;
    }

    .history-item::before {
        content: '';
        position: absolute;
        left: -6px;
        top: 18px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--accent-blue);
    }

    .history-item.resolved::before {
        background: var(--success-green);
    }

    .history-item.ongoing::before {
        background: var(--danger-red);
    }

    .history-date {
        font-size: 12px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .history-title {
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 4px;
    }

    .history-desc {
        font-size: 13px;
        color: #64748b;
    }

    /* Map Container */
    .tourist-map {
        height: 250px;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #e2e8f0;
        margin: 12px 0;
    }

    /* Travel Path */
    .travel-path {
        margin: 12px 0;
    }

    .path-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .path-item:last-child {
        border-bottom: none;
    }

    .path-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--accent-blue);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
    }

    .path-location {
        flex: 1;
        font-size: 13px;
        font-weight: 600;
        color: var(--primary-dark);
    }

    .path-date {
        font-size: 12px;
        color: #64748b;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .tourists-layout {
            grid-template-columns: 1fr;
            height: auto;
        }
        
        .tourist-profile-panel {
            max-height: 500px;
        }
    }

    @media (max-width: 768px) {
        .tourists-table-header,
        .tourist-row {
            grid-template-columns: 1fr;
            gap: 8px;
        }
        
        .search-row {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-input {
            min-width: auto;
        }
    }
</style>
<body>
    <body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shield-alt fa-2x mb-2"></i>
            <h4 data-en="Police & Tourism" data-hi="पुलिस और पर्यटन">Tourism Authority of India</h4>
            <small data-en="Authority Dashboard" data-hi="प्राधिकरण डैशबोर्ड">Authority Dashboard</small>
        </div>
        <ul class="sidebar-nav">
            <li><a href="index.html" class="nav-link" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span data-en="Dashboard" data-hi="डैशबोर्ड">Dashboard</span>
                </a></li>
            <li><a href="alert.html" class="nav-link" data-section="alerts">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span data-en="Alerts" data-hi="अलर्ट">Alerts</span>
                </a></li>
            <li><a href="tourist.html" class="nav-link active" data-section="tourists">
                    <i class="fas fa-users"></i>
                    <span data-en="Tourists" data-hi="पर्यटक">Tourists</span>
                </a></li>
            <li><a href="reports.html" class="nav-link" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span data-en="Reports" data-hi="रिपोर्ट्स">Reports</span>
                </a></li>
            <li><a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span data-en="Settings" data-hi="सेटिंग्स">Settings</span>
                </a></li>
        </ul>
    </nav>

    <div class="main-content">
        <!-- Tourists Header -->
        <div class="tourists-header">
            <div class="tourists-title">
                <div class="tourists-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div>
                    <h1>Tourist Management System</h1>
                    <p class="tourists-subtitle">Monitor and manage tourist registrations, safety status, and travel information</p>
                </div>
            </div>
        </div>

        <!-- Search and Controls -->
        <div class="tourists-controls">
            <div class="search-row">
                <input type="text" class="search-input" id="touristSearch" placeholder="Search by name, ID, passport, or location...">
                
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="safe">Safe</option>
                        <option value="monitoring">Under Monitoring</option>
                        <option value="alerted">Alerted</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Nationality</label>
                    <select class="filter-select" id="nationalityFilter">
                        <option value="">All Countries</option>
                        <option value="United States">United States</option>
                        <option value="United Kingdom">United Kingdom</option>
                        <option value="Germany">Germany</option>
                        <option value="France">France</option>
                        <option value="Spain">Spain</option>
                        <option value="China">China</option>
                        <option value="Japan">Japan</option>
                        <option value="Australia">Australia</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select class="filter-select" id="sortBy">
                        <option value="recent">Recently Added</option>
                        <option value="name">Name A-Z</option>
                        <option value="status">Status</option>
                        <option value="nationality">Nationality</option>
                    </select>
                </div>
                
                <div class="view-toggle">
                    <button class="view-btn active" id="tableViewBtn" onclick="switchView('table')">
                        <i class="fas fa-table"></i>
                        Table
                    </button>
                    <button class="view-btn" id="listViewBtn" onclick="switchView('list')">
                        <i class="fas fa-list"></i>
                        List
                    </button>
                </div>
            </div>
        </div>

        <!-- Tourist Layout -->
        <div class="tourists-layout" id="touristsLayout">
            <!-- Tourist Directory -->
            <div class="tourists-directory">
                <div class="tourists-table-header">
                    <div>Tourist ID</div>
                    <div>Name</div>
                    <div>Nationality</div>
                    <div>Passport</div>
                    <div>Contact</div>
                    <div>Status</div>
                    <div>Last Seen Location</div>
                    <div>Actions</div>
                </div>
                
                <div class="tourists-table-body" id="touristsTableBody">
                    <!-- Tourist rows will be populated by JavaScript -->
                </div>
            </div>

            <!-- Tourist Profile Panel -->
            <div class="tourist-profile-panel" id="profilePanel">
                <div class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-name" id="profileName">Select a Tourist</div>
                    <div class="profile-id" id="profileId">Click on a tourist to view details</div>
                </div>
                
                <div class="profile-content" id="profileContent">
                    <div style="display: flex; align-items: center; justify-content: center; height: 200px; color: #64748b;">
                        <div style="text-align: center;">
                            <i class="fas fa-mouse-pointer" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                            <p>Select a tourist from the directory to view detailed profile information</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    // Global variables
    let tourists = [];
    let filteredTourists = [];
    let selectedTourist = null;
    let touristMap = null;
    let currentView = 'table';

    // Mock tourist data
    const mockTourists = [
        {
            id: 'TID-2024-001234',
            name: 'Anish Kumar',
            nationality: 'United States',
            passport: 'US123456789',
            phone: '+1-555-0123',
            email: 'anish.kumar@email.com',
            status: 'safe',
            lastSeen: 'Taj Mahal, Agra',
            coordinates: [27.1751, 78.0421],
            age: 32,
            gender: 'Male',
            entryDate: '2024-09-15',
            exitDate: '2024-09-25',
            emergencyContact: 'Jane Smith - +1-555-0124',
            digitalIdExpiry: '2024-12-31',
            itinerary: [
                { location: 'Delhi', date: '2024-09-15', type: 'arrival' },
                { location: 'Agra', date: '2024-09-16', type: 'visit' },
                { location: 'Jaipur', date: '2024-09-18', type: 'visit' },
                { location: 'Mumbai', date: '2024-09-22', type: 'visit' },
                { location: 'Delhi', date: '2024-09-25', type: 'departure' }
            ],
            safetyHistory: [
                { date: '2024-09-20', type: 'resolved', title: 'Minor scam incident', description: 'Overcharged by taxi driver, resolved with refund' },
                { date: '2024-09-18', type: 'resolved', title: 'Lost wallet reported', description: 'Found and returned by hotel staff' }
            ]
        },
        {
            id: 'TID-2024-001235',
            name: 'Kiara',
            nationality: 'Spain',
            passport: 'ES987654321',
            phone: '+34-600-123456',
            email: 'kiara@email.com',
            status: 'monitoring',
            lastSeen: 'Red Fort, Delhi',
            coordinates: [28.6562, 77.2410],
            age: 28,
            gender: 'Female',
            entryDate: '2024-09-18',
            exitDate: '2024-09-28',
            emergencyContact: 'Carlos Garcia - +34-600-123457',
            digitalIdExpiry: '2024-11-30',
            itinerary: [
                { location: 'Delhi', date: '2024-09-18', type: 'arrival' },
                { location: 'Mumbai', date: '2024-09-20', type: 'visit' },
                { location: 'Goa', date: '2024-09-23', type: 'visit' },
                { location: 'Mumbai', date: '2024-09-28', type: 'departure' }
            ],
            safetyHistory: [
                { date: '2024-09-21', type: 'ongoing', title: 'Theft reported', description: 'Wallet and documents stolen at market, investigation ongoing' }
            ]
        },
        {
            id: 'TID-2024-001236',
            name: 'Lakshmi',
            nationality: 'United Kingdom',
            passport: 'UK456789123',
            phone: '+44-20-1234-5678',
            email: 'lakshmi@email.com',
            status: 'safe',
            lastSeen: 'Gateway of India, Mumbai',
            coordinates: [18.9220, 72.8347],
            age: 45,
            gender: 'Male',
            entryDate: '2024-09-10',
            exitDate: '2024-09-30',
            emergencyContact: 'Sarah Wilson - +44-20-1234-5679',
            digitalIdExpiry: '2025-01-15',
            itinerary: [
                { location: 'Mumbai', date: '2024-09-10', type: 'arrival' },
                { location: 'Goa', date: '2024-09-12', type: 'visit' },
                { location: 'Kerala', date: '2024-09-18', type: 'visit' },
                { location: 'Mumbai', date: '2024-09-28', type: 'visit' },
                { location: 'Mumbai', date: '2024-09-30', type: 'departure' }
            ],
            safetyHistory: [
                { date: '2024-09-19', type: 'resolved', title: 'Overcharging complaint', description: 'Taxi driver overcharging resolved by tourist police' }
            ]
        },
        {
            id: 'TID-2024-001237',
            name: 'Meera',
            nationality: 'China',
            passport: 'CN789123456',
            phone: '+86-138-0013-8000',
            email: 'meera@email.com',
            status: 'alerted',
            lastSeen: 'Jaisalmer Fort, Rajasthan',
            coordinates: [26.9124, 70.9083],
            age: 26,
            gender: 'Female',
            entryDate: '2024-09-16',
            exitDate: '2024-09-26',
            emergencyContact: 'Michael Chen - +86-138-0013-8001',
            digitalIdExpiry: '2024-12-20',
            itinerary: [
                { location: 'Delhi', date: '2024-09-16', type: 'arrival' },
                { location: 'Jaipur', date: '2024-09-17', type: 'visit' },
                { location: 'Jaisalmer', date: '2024-09-19', type: 'visit' },
                { location: 'Jodhpur', date: '2024-09-22', type: 'visit' },
                { location: 'Delhi', date: '2024-09-26', type: 'departure' }
            ],
            safetyHistory: [
                { date: '2024-09-22', type: 'ongoing', title: 'Missing person alert', description: 'Did not return to hotel, search team deployed' },
                { date: '2024-09-20', type: 'resolved', title: 'Health issue', description: 'Minor illness, treated at local clinic' }
            ]
        },
        {
            id: 'TID-2024-001238',
            name: 'Rohan',
            nationality: 'UAE',
            passport: 'AE654321987',
            phone: '+971-50-123-4567',
            email: 'ahmed.hassan@email.com',
            status: 'safe',
            lastSeen: 'Calicut, Kerala',
            coordinates: [11.2588, 75.7804],
            age: 38,
            gender: 'Male',
            entryDate: '2024-09-12',
            exitDate: '2024-09-22',
            emergencyContact: 'Fatima Hassan - +971-50-123-4568',
            digitalIdExpiry: '2025-02-10',
            itinerary: [
                { location: 'Kochi', date: '2024-09-12', type: 'arrival' },
                { location: 'Munnar', date: '2024-09-14', type: 'visit' },
                { location: 'Alleppey', date: '2024-09-16', type: 'visit' },
                { location: 'Calicut', date: '2024-09-19', type: 'visit' },
                { location: 'Kochi', date: '2024-09-22', type: 'departure' }
            ],
            safetyHistory: [
                { date: '2024-09-17', type: 'resolved', title: 'Anomaly detection', description: 'Unusual movement pattern detected, investigated and cleared' }
            ]
        },
        {
            id: 'TID-2024-001239',
            name: 'Kamal ',
            nationality: 'Australia',
            passport: 'AU987123654',
            phone: '+61-2-1234-5678',
            email: 'kamal@email.com',
            status: 'inactive',
            lastSeen: 'Bangalore Palace',
            coordinates: [12.9716, 77.5946],
            age: 29,
            gender: 'Female',
            entryDate: '2024-09-05',
            exitDate: '2024-09-20',
            emergencyContact: 'James Thompson - +61-2-1234-5679',
            digitalIdExpiry: '2024-10-05',
            itinerary: [
                { location: 'Bangalore', date: '2024-09-05', type: 'arrival' },
                { location: 'Mysore', date: '2024-09-07', type: 'visit' },
                { location: 'Hampi', date: '2024-09-10', type: 'visit' },
                { location: 'Goa', date: '2024-09-15', type: 'visit' },
                { location: 'Bangalore', date: '2024-09-20', type: 'departure' }
            ],
            safetyHistory: []
        }
    ];

    // Initialize system
    document.addEventListener('DOMContentLoaded', function() {
        tourists = [...mockTourists];
        filteredTourists = [...tourists];
        renderTourists();
        setupEventListeners();
    });

    // Setup event listeners
    function setupEventListeners() {
        document.getElementById('touristSearch').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('nationalityFilter').addEventListener('change', applyFilters);
        document.getElementById('sortBy').addEventListener('change', applyFilters);
    }

    // Apply filters and sorting
    function applyFilters() {
        const searchTerm = document.getElementById('touristSearch').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        const nationalityFilter = document.getElementById('nationalityFilter').value;
        const sortBy = document.getElementById('sortBy').value;

        filteredTourists = tourists.filter(tourist => {
            const matchesSearch = !searchTerm || 
                tourist.name.toLowerCase().includes(searchTerm) ||
                tourist.id.toLowerCase().includes(searchTerm) ||
                tourist.passport.toLowerCase().includes(searchTerm) ||
                tourist.lastSeen.toLowerCase().includes(searchTerm);
            
            const matchesStatus = !statusFilter || tourist.status === statusFilter;
            const matchesNationality = !nationalityFilter || tourist.nationality === nationalityFilter;
            
            return matchesSearch && matchesStatus && matchesNationality;
        });

        // Sort tourists
        filteredTourists.sort((a, b) => {
            switch(sortBy) {
                case 'name':
                    return a.name.localeCompare(b.name);
                case 'status':
                    const statusOrder = { alerted: 4, monitoring: 3, safe: 2, inactive: 1 };
                    return statusOrder[b.status] - statusOrder[a.status];
                case 'nationality':
                    return a.nationality.localeCompare(b.nationality);
                case 'recent':
                default:
                    return new Date(b.entryDate) - new Date(a.entryDate);
            }
        });

        renderTourists();
    }

    // Render tourists table
    function renderTourists() {
        const tbody = document.getElementById('touristsTableBody');
        tbody.innerHTML = '';

        filteredTourists.forEach(tourist => {
            const row = createTouristRow(tourist);
            tbody.appendChild(row);
        });
    }

    // Create tourist row
    function createTouristRow(tourist) {
        const row = document.createElement('div');
        row.className = 'tourist-row';
        row.onclick = () => selectTourist(tourist);

        const statusIndicator = getStatusIndicator(tourist.status);
        const maskedPassport = maskPassport(tourist.passport);
        const maskedPhone = maskPhone(tourist.phone);

        row.innerHTML = `
            <div style="font-weight: 600; color: var(--primary-dark);">${tourist.id}</div>
            <div>
                <div style="font-weight: 600;">${tourist.name}</div>
                <div style="font-size: 12px; color: #64748b;">${tourist.age}y, ${tourist.gender}</div>
            </div>
            <div>${tourist.nationality}</div>
            <div>
                <span class="masked-value">${maskedPassport}</span>
            </div>
            <div>
                <div style="font-size: 13px;">${maskedPhone}</div>
                <div style="font-size: 12px; color: #64748b;">${tourist.email.substring(0, 20)}...</div>
            </div>
            <div>${statusIndicator}</div>
            <div style="font-size: 13px;">${tourist.lastSeen}</div>
            <div>
                <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); selectTourist(${JSON.stringify(tourist).replace(/"/g, '&quot;')})">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
        `;

        return row;
    }

    // Helper functions
    function getStatusIndicator(status) {
        const statusTexts = {
            safe: 'Safe',
            monitoring: 'Monitoring',
            alerted: 'Alerted',
            inactive: 'Inactive'
        };
        
        return `<div class="status-indicator status-${status}">
            <div class="status-dot"></div>
            <span>${statusTexts[status]}</span>
        </div>`;
    }

    function maskPassport(passport) {
        if (passport.length <= 4) return passport;
        return passport.substring(0, 2) + '●●●●●' + passport.substring(passport.length - 2);
    }

    function maskPhone(phone) {
        if (phone.length <= 8) return phone;
        return phone.substring(0, 5) + '●●●●' + phone.substring(phone.length - 3);
    }

    // Select tourist and show profile
    function selectTourist(tourist) {
        selectedTourist = tourist;
        
        // Update selected row styling
        document.querySelectorAll('.tourist-row').forEach(row => row.classList.remove('selected'));
        event.currentTarget.classList.add('selected');

        // Update profile header
        document.getElementById('profileName').textContent = tourist.name;
        document.getElementById('profileId').textContent = tourist.id;

        // Show profile details
        const profileContent = document.getElementById('profileContent');
        profileContent.innerHTML = `
            <!-- Personal Information -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-user"></i>
                    Personal Information
                </div>
                <div class="profile-item">
                    <span class="profile-label">Full Name:</span>
                    <span class="profile-value">${tourist.name}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Nationality:</span>
                    <span class="profile-value">${tourist.nationality}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Gender:</span>
                    <span class="profile-value">${tourist.gender}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Age:</span>
                    <span class="profile-value">${tourist.age} years</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Status:</span>
                    <span class="profile-value">${getStatusIndicator(tourist.status)}</span>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-phone"></i>
                    Contact Information
                </div>
                <div class="profile-item">
                    <span class="profile-label">Phone:</span>
                    <span class="profile-value">${tourist.phone}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Email:</span>
                    <span class="profile-value">${tourist.email}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Emergency Contact:</span>
                    <span class="profile-value">${tourist.emergencyContact}</span>
                </div>
            </div>

            <!-- Travel Documents -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-passport"></i>
                    Travel Documents
                </div>
                <div class="profile-item">
                    <span class="profile-label">Passport Number:</span>
                    <span class="profile-value"><span class="masked-value">${tourist.passport}</span></span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Entry Date:</span>
                    <span class="profile-value">${new Date(tourist.entryDate).toLocaleDateString()}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Exit Date:</span>
                    <span class="profile-value">${new Date(tourist.exitDate).toLocaleDateString()}</span>
                </div>
            </div>

            <!-- Digital ID Access -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-qrcode"></i>
                    Digital ID Access
                </div>
                <div class="digital-id-card">
                    <div class="qr-code">
                        <i class="fas fa-qrcode"></i>
                    </div>
                    <div style="font-weight: 600; margin-bottom: 4px;">Tourist Digital ID</div>
                    <div style="font-size: 14px; opacity: 0.9;">${tourist.id}</div>
                    <div class="validity-status">Valid until: ${new Date(tourist.digitalIdExpiry).toLocaleDateString()}</div>
                </div>
            </div>

            <!-- Travel Itinerary -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-route"></i>
                    Travel Itinerary
                </div>
                <div class="travel-path">
                    ${tourist.itinerary.map((item, index) => `
                        <div class="path-item">
                            <div class="path-icon">${index + 1}</div>
                            <div class="path-location">${item.location}</div>
                            <div class="path-date">${new Date(item.date).toLocaleDateString()}</div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <!-- Current Location Map -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Current Location
                </div>
                <div class="profile-item">
                    <span class="profile-label">Last Seen:</span>
                    <span class="profile-value">${tourist.lastSeen}</span>
                </div>
                <div id="touristMap" class="tourist-map"></div>
            </div>

            <!-- Safety History -->
            <div class="profile-section">
                <div class="section-title">
                    <i class="fas fa-shield-alt"></i>
                    Safety History
                </div>
                ${tourist.safetyHistory.length > 0 ? `
                    <div class="history-timeline">
                        ${tourist.safetyHistory.map(incident => `
                            <div class="history-item ${incident.type}">
                                <div class="history-date">${new Date(incident.date).toLocaleDateString()}</div>
                                <div class="history-title">${incident.title}</div>
                                <div class="history-desc">${incident.description}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : '<p style="color: #64748b; font-style: italic;">No safety incidents reported</p>'}
            </div>
        `;

        // Initialize map for this tourist
        setTimeout(() => initTouristMap(tourist), 100);
    }

    // Initialize map for selected tourist
    function initTouristMap(tourist) {
        const mapContainer = document.getElementById('touristMap');
        if (!mapContainer) return;

        if (touristMap) {
            touristMap.remove();
        }

        touristMap = L.map('touristMap').setView(tourist.coordinates, 12);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(touristMap);

        // Add tourist location marker
        const touristIcon = L.divIcon({
            html: '<div style="background: #3b82f6; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"><i class="fas fa-user"></i></div>',
            iconSize: [20, 20],
            className: 'custom-div-icon'
        });

        L.marker(tourist.coordinates, { icon: touristIcon })
            .addTo(touristMap)
            .bindPopup(`<strong>${tourist.name}</strong><br>${tourist.lastSeen}<br>Status: ${tourist.status.charAt(0).toUpperCase() + tourist.status.slice(1)}`);

        // Add travel path if available
        if (tourist.itinerary && tourist.itinerary.length > 1) {
            const pathCoordinates = [
                [28.6139, 77.2090], // Delhi
                [27.1751, 78.0421], // Agra
                [26.9124, 70.9083], // Jaipur
                [19.0760, 72.8777]  // Mumbai
            ];

            L.polyline(pathCoordinates, {
                color: '#10b981',
                weight: 3,
                opacity: 0.7,
                dashArray: '5, 10'
            }).addTo(touristMap);
        }

        setTimeout(() => touristMap.invalidateSize(), 100);
    }

    // Switch between table and list view
    function switchView(view) {
        currentView = view;
        const layout = document.getElementById('touristsLayout');
        const tableBtn = document.getElementById('tableViewBtn');
        const listBtn = document.getElementById('listViewBtn');

        if (view === 'list') {
            layout.classList.add('list-view');
            tableBtn.classList.remove('active');
            listBtn.classList.add('active');
        } else {
            layout.classList.remove('list-view');
            listBtn.classList.remove('active');
            tableBtn.classList.add('active');
        }
    }
</script>
</body>
</html>